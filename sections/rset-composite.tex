% file: sections/rset-composite
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Replicated Set with Composite Operations}

We consider the replicated set data type with composite operations 
including union ($\cup$), intersection ($\cap$), and set difference ($\setminus$).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Specification}	\label{ss:rset-composite-spec}

General method for set union, set intersection, and set difference:
There are four $\cdots$

\begin{align}
  \F_{\orset}&(A \setminus B, \C_{A}, \C_{B}) \\
  &= \{ a \mid \exists (e, e') \in E_A \times E_B. 
  	\Big( \big(\op(e) = \add(a) \land \op(e') = \remove(a)\big) \\
      	    &\qquad\qquad \land \forall (f, f') \in E_A \times E_B. 
      	        \big( (\op(f) = \add(a) \land \op(f') = \add(a)) 
		      \lor (\op(f) = \remove(a) \land \op(f') = \add(a)) 
		      \lor (\op(f) = \remove(a) \land \op(f') = \remove(a)) 
		\big) \\
	    & \implies \lnot \big(\visord{(e, e')}{(f, f')\big)}
	\Big)
	      \}.
\end{align}

\begin{example}[Specification for Composite Operations of Replicated Set]
\end{example}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Protocol}		\label{ss:rset-composite-protocol}

\subsubsection{Methodology}	\label{sss:rset-methodology}

Op-based

We always assume that $(\A \cup \R) \cap (\A' \cup \R') = \emptyset$.
Note that for any replica state $(a, \A, \R)$, we have $\R \subseteq \A$.

The goal is to find $\Box$ and $\Diamond$ such that
\[
   \cdots \iff \Box \subseteq \Diamond
\]

\begin{figure}[t]
  \[
    \begin{array}{lcl}
      U &:& \text{universe of elements}	\\
      I &:& \text{set of identifiers}	\\
      \A, \R  &\in& \text{SUBSET } \I	\\
      \Sigma &=& \U \times \A \times \R \\
      \sigma_{0} &=& \lambda r.\; \emptyset
    \end{array}
  \]
  \caption{Implementation of replicated set with composite operations.}
  \label{fig:rset-composite-protocol}
\end{figure}
%%%%%%%%%%%%%%%%%%%%
\subsubsection{Set Union ($\cup$)}

\begin{theorem}[Set Union]
  Given that $\R \subseteq \A$ and $\R' \subseteq \A'$, we have
  \[
    (\R \subset \A) \lor (\R' \subset \A') \iff (\R \cup \R') \subset (\A \cup \A').
  \]
\end{theorem}
%%%%%%%%%%%%%%%%%%%%
\subsubsection{Set Intersection ($\cap$)}

\marginnote{Another way: IF THEN ELSE}

The goal is to find $\Box$ and $\Diamond$ such that
\[
  (\R \subset \A) \lor (\R' \subset \A') \iff \Box \subset \Diamond
\]

\begin{theorem}[Set Intersection]
  Given that $\R \subseteq \A$ and $\R' \subseteq \A'$, we have \marginnote{\question{$\emptyset$ issues}}
  \[
    (\R \subset \A) \land (\R' \subset \A') \iff (\A \times \R') \cup (\R \times \A') \subset (\A \times \A').
  \]
\end{theorem}
%%%%%%%%%%%%%%%%%%%%
\subsubsection{Set Difference ($\setminus$)}

The goal is to find $\Box$ and $\Diamond$ such that
\[
  (\R \subset \A) \land (\R' \not\subset \A') \iff \Box \subset \Diamond
\]

\begin{theorem}[Set Difference]
  Given that $\R \subseteq \A$ and $\R' \subseteq \A'$, we have \marginnote{\question{$\emptyset$ issues}}
  \[
    (\R \subset \A) \land (\R' \not\subset \A') \iff (\R \times \A') \subset (\A \times \R').
  \]
\end{theorem}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
